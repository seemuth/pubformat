<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Citation List Converter</title>
<style type="text/css" media="all">
body { background-color: whitesmoke; text-align: center; }
div.main { margin-left: auto; margin-right: auto; max-width: 1000px; background-color: white; }
div.label { font-weight: bold; }
div.data { margin-top: 1em; margin-bottom: 1em; }
textarea { margin-left: auto; margin-right: auto; }
p.version { font-size: 75%; color: grey; }
#output { background-color: lightskyblue; text-align: left; }
li.good { background-color: #cfffcf; }
li.bad { background-color: #ffcfcf; }
li.unknown { background-color: inherit; }
li.conflict { background: repeating-linear-gradient(90deg, #cfffcf, #cfffcf 10px, #ffcfcf 10px, #ffcfcf 20px); }
</style>
<body>
<div class="main">
    <div class="data">
        <div class="label">Citation data input</div>
        <div class="databox">
            <textarea id="datain" rows="20" cols="90" onchange="datainchange(this)" onkeyup="datainchange(this)" onfocus="this.select()"></textarea>
        </div>
        <div class="params">
            Publication list owner name: <input id="owner" type="text" size="30" />
        </div>
    </div>
    <div class="status"><span id="status"></span></div>
    <div class="data">
        <div class="label">Post output</div>
        <div class="databox">
            <p id="output"></p>
        </div>
    </div>
</div>
<script>
config={splitConferenceJournal:false,};function valuefilter(b){b=b.replace(/^{(.*)},?$/,"$1");var a=[[/{?\\(["'`~^])\\*(({[^}]+})|[^{])}?/g,function(k,j,f){var h=false;var m="";var q="";if(h){m='<span class="pub-special">_';q="_</span>"}var o=f.replace(/^{(.*)},?$/,"$1");var n=['"',"'","`","~","^"];var g=["uml","acute","grave","tilde","circ"];var l=n.indexOf(j);if(l<0){return f}var p=g[l];return[m,"&",o,p,";",q,].join("")}],["/\\%/g","%"],[/\\&/g,"&amp;"],[/---/g,"&mdash;"],[/--/g,"&ndash;"],[/"/g,"&quot;"],[/“/g,"&ldquo;"],[/“/g,"&ldquo;"],[/‘/g,"&rsquo;"],[/’/g,"&rsquo;"],];for(var e=0;e<a.length;e++){var d=a[e][0];var c=a[e][1];b=b.replace(d,c)}return b}function importbib(e){var f=[];var a={};var h=e.split("\n");for(var c=0;c<h.length;c++){var j=h[c].trim();var d=j.indexOf("=");if((d<0)&&(j.indexOf("}")>=0)){f.push(a);a={}}else{if(d>0){var b=j.substr(0,d);var g=valuefilter(j.substr(d+1));a[b]=g}else{if(j.substr(0,1)=="@"){var b="@";var g=j.replace(/^@([^{]+){.*$/,"$1");a[b]=g}}}}return f}function pubsortcompare(d,c){if(d.year==c.year){if(d.title<c.title){return -1}else{if(d.title==c.title){return 0}else{return 1}}}else{if(d.year==undefined){return 1}else{if(c.year==undefined){return -1}else{if(d.year>c.year){return -1}else{return 1}}}}}function pubisabstract(a){if(a.booktitle==undefined){return false}if(a.booktitle.toLowerCase().indexOf("abstract")>=0){return true}return false};function splitauthors(b){var a=b.split(" and ");return a.join("; ")}function pubtopost(a){var b=[];var c=undefined;if((c==undefined)&&(a.booktitle!=undefined)){c=a.booktitle}else{if((c==undefined)&&(a.journal!=undefined)){c=a.journal}}var d="<!--"+a["@"]+"-->";b.push(splitauthors(a.author));b.push("<strong>"+a.title+"</strong>");if(c!=undefined){b.push("<em>"+c+"</em>")}if(a.year!=undefined){b.push("("+a.year+")")}if(a.note!=undefined){b.push('<span class="pub-note">'+a.note+"</span>")}return d+b.join(". ")}function exportpost(e){var a=document.getElementById("owner").value.trim();var c=[];c.push('<ol class="publications">');for(var d=0;d<e.length;d++){var b=classify(e[d],a);c.push('<li class="'+b+'">'+pubtopost(e[d])+"</li>")}c.push("</ol>");return c.join("\n")};function classify(d,a){var e=filterpub(d,a);var b=[];if((e.pos.length>0)&&(e.neg.length>0)){b.push("conflict")}else{if(e.pos.length>0){b.push("good")}else{if(e.neg.length>0){b.push("bad")}else{b.push("unknown")}}}for(var c=0;c<e.pos.length;c++){b.push("good_"+e.pos[c])}for(var c=0;c<e.neg.length;c++){b.push("bad_"+e.neg[c])}for(var c=0;c<e.zero.length;c++){b.push("zero_"+e.zero[c])}return b.join(" ")}function filterpub(f,b){var j=[];var g=[];var d=[];var c={ownername:filter_ownername,noyear:filter_noyear,thesis:filter_thesis,};for(var a in c){var e=c[a];var h=e(f,b);if(h>0){j.push(a)}else{if(h==0){g.push(a)}else{d.push(a)}}}var i={pos:j,zero:g,neg:d,};return i}function filter_ownername(f,a){var c=-1;var b=f.author.split(" and ");a=a.toLowerCase();for(var d=0;d<b.length;d++){var e=b[d].toLowerCase();if(e.substr(0,a.length)==a){c=1;break}}return c}function filter_noyear(a){if(a.year==undefined){return -1}return 0}function filter_thesis(b){var a=b["@"].toLowerCase();if(a.substr(a.length-6)=="thesis"){return -1}return 0};var statusstate=0;var statusinterval=null;function updatestatusdisplay(){var a=document.getElementById("status");statusstate--;if(statusstate<0){a.innerHTML="";window.clearInterval(statusinterval);statusinterval=null;return}if(statusstate>=25){var b=255-(10*(statusstate-25));if(b>255){b=255}else{if(b<0){b=0}}a.style["background-color"]=("rgb("+b.toString()+",255,"+b.toString()+")")}else{var b=255-(10*statusstate);if(b<0){b=0}a.style.color=("rgb("+b.toString()+","+b.toString()+","+b.toString()+")")}}function setstatus(b){var a=document.getElementById("status");a.innerHTML=b;a.style.color="rgb(0,0,0)";a.style["background-color"]="rgb(0,255,0)";statusstate=50;if(statusinterval==null){statusinterval=window.setInterval(updatestatusdisplay,100)}}function datainchange(g){var l={abstracts:[],conference:["inproceedings",],journal:["article","incollection",],other:[],};if(!config.splitConferenceJournal){l.papers=[];for(var d=0;d<l.conference.length;d++){l.papers.push(l.conference[d])}for(var d=0;d<l.journal.length;d++){l.papers.push(l.journal[d])}delete l.conference;delete l.journal}var a=document.getElementById("output");var f=importbib(g.value);var h={};for(var b in l){h[b]=[]}a.innerHTML="";f.sort(pubsortcompare);for(var d in f){var c=f[d];var e="other";for(var b in l){if(l[b].indexOf(c["@"])>=0){e=b;break}}if(pubisabstract(c)){e="abstracts"}h[e].push(c)}var j=[];if((h.conference!=undefined)&&(h.conference.length>0)){j.push("<h2>Conference Papers</h2>");j.push(exportpost(h.conference))}if((h.journal!=undefined)&&(h.journal.length>0)){j.push("<h2>Journal Articles</h2>");j.push(exportpost(h.journal))}if((h.papers!=undefined)&&(h.papers.length>0)){j.push("<h2>Papers</h2>");j.push(exportpost(h.papers))}if((h.abstracts!=undefined)&&(h.abstracts.length>0)){j.push("<h2>Abstracts</h2>");j.push(exportpost(h.abstracts))}if((h.other!=undefined)&&(h.other.length>0)){j.push("<h2>Other</h2>");j.push(exportpost(h.other))}a.innerHTML=j.join("\n");if(a.innerHTML.length>0){setstatus("Generated post content.")}else{setstatus("Error generating post content!")}};</script>
<p class="version">Version v0.5.0</p>
</body>
</html>
